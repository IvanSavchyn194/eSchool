pipeline{
    agent any
    environment {
    SECRET_IP = credentials('eSchool-prod-IP')
    SECRET_USERNAME = credentials('eschool_username')
    }
    stages{
   
        stage('compile'){
            steps{
                    sh 'mvn clean compile'
            }
        }
        stage('test'){
            steps{
                sh 'mvn test -Dtest=!academy.softserve.eschool.*.*IntegrationTest'
            }
        }
       
        stage("Build"){
            steps{
                    sh 'mvn package -Dmaven.test.skip=true'
            }
        }
        stage("Publish to Azure") {
            steps {
                azureWebAppPublish appName: "eschooltest",
                    azureCredentialsId: "c394124b-5b95-41a0-82fc-08a9916e0d95",
                    publishType: "file",
                    filePath: "**/*.*",
                    resourceGroup: "vm",
                    sourceDirectory: "Default Directory (vanjasav194gmail.onmicrosoft.com)"
            }
        }
    }
}
