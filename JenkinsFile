pipeline{
    agent any
    stages{
        stage('compile'){
            steps{
                    sh 'mvn clean compile'
            }
        }
        stage('test'){
            steps{
                    sh 'mvn test -Dtest=!academy.softserve.eschool.*.*IntegrationTest'
            }
        }
        stage("Build"){
            steps{
                    sh 'mvn package -Dmaven.test.skip=true'
            }
        }
    }
sshPublisher(publishers: [sshPublisherDesc(configName: 'eSchool_prod', transfers: [sshTransfer(cleanRemote: false, excludes: '', execCommand: '''sudo systemctl stop eSchool_restart.service
mv /home/azureuser/eSchool/eschool.jar /home/azureuser/eSchool/eSchool_bec/eschool$(date +"%FT%T").jar''', execTimeout: 120000, flatten: false, makeEmptyDirs: false, noDefaultExcludes: false, patternSeparator: '[, ]+', remoteDirectory: '', remoteDirectorySDF: false, removePrefix: '', sourceFiles: ''), sshTransfer(cleanRemote: false, excludes: '', execCommand: 'sudo systemctl start eSchool_restart.service', execTimeout: 120000, flatten: false, makeEmptyDirs: false, noDefaultExcludes: false, patternSeparator: '[, ]+', remoteDirectory: '', remoteDirectorySDF: false, removePrefix: 'target', sourceFiles: 'target/*.jar')], usePromotionTimestamp: false, useWorkspaceInPromotion: false, verbose: false)])
}
